<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <!--meta name="viewport" content="width=device-width, initial-scale=1"-->
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <title>Mol* Viewer</title>
    <link rel="stylesheet" type="text/css" href="./molstar.css" />
</head>
<body>
    <div id="app"></div>
    <script type="text/javascript" src="./molstar.js"></script>
    <script type="text/javascript">
        function getParam(name, regex) {
            let r = new RegExp(name + '=' + '(' + regex + ')[&]?', 'i');
            return decodeURIComponent(((window.location.search || '').match(r) || [])[1] || '');
        }

        let debugMode = getParam('debug-mode', '[^&]+').trim() === '1';
        if (debugMode) molstar.setDebugMode(debugMode, debugMode);

        let hideControls = getParam('hide-controls', '[^&]+').trim() === '1';
        let collapseLeftPanel = getParam('collapse-left-panel', '[^&]+').trim() === '1';
        let pdbProvider = getParam('pdb-provider', '[^&]+').trim().toLowerCase();
        let emdbProvider = getParam('emdb-provider', '[^&]+').trim().toLowerCase();
        let mapProvider = getParam('map-provider', '[^&]+').trim().toLowerCase();
        let pixelScale = getParam('pixel-scale', '[^&]+').trim();
        let pickScale = getParam('pick-scale', '[^&]+').trim();
        let pickPadding = getParam('pick-padding', '[^&]+').trim();
        let viewer = new molstar.Viewer('app', {
            layoutShowControls: !hideControls,
            viewportShowExpand: false,
            collapseLeftPanel: collapseLeftPanel,
            pdbProvider: pdbProvider || 'pdbe',
            emdbProvider: emdbProvider || 'pdbe',
            volumeStreamingServer: (mapProvider || 'pdbe') === 'rcsb'
                ? 'https://maps.rcsb.org'
                : 'https://www.ebi.ac.uk/pdbe/densities',
            pixelScale: parseFloat(pixelScale) || 1,
            pickScale: parseFloat(pickScale) || 0.25,
            pickPadding: isNaN(parseFloat(pickPadding)) ? 1 : parseFloat(pickPadding),
        });

        let snapshotId = getParam('snapshot-id', '[^&]+').trim();
        if (snapshotId) viewer.setRemoteSnapshot(snapshotId);

        let snapshotUrl = getParam('snapshot-url', '[^&]+').trim();
        let snapshotUrlType = getParam('snapshot-url-type', '[^&]+').toLowerCase().trim() || 'molj';
        if (snapshotUrl && snapshotUrlType) viewer.loadSnapshotFromUrl(snapshotUrl, snapshotUrlType);

        let structureUrl = getParam('structure-url', '[^&]+').trim();
        let structureUrlFormat = getParam('structure-url-format', '[a-z]+').toLowerCase().trim();
        let structureUrlIsBinary = getParam('structure-url-is-binary', '[^&]+').trim() === '1';
        if (structureUrl) viewer.loadStructureFromUrl(structureUrl, structureUrlFormat, structureUrlIsBinary);

        let pdb = getParam('pdb', '[^&]+').trim();
        if (pdb) viewer.loadPdb(pdb);

        let pdbDev = getParam('pdb-dev', '[^&]+').trim();
        if (pdbDev) viewer.loadPdbDev(pdbDev);

        let emdb = getParam('emdb', '[^&]+').trim();
        if (emdb) viewer.loadEmdb(emdb);

        // Start preloading
        viewer.loadStructureFromUrl('./pdb_extract_MLuteus_133.cif', 'mmcif', false, { representationParams: { theme: { globalName: 'operator-name' } } });
        viewer.loadStructureFromUrl('./MLuteus_AlphaFold_133.pdb', 'pdb', false, { representationParams: { theme: { globalName: 'operator-name' } } });
        // End preloading
    </script> 
</body>
</html> 